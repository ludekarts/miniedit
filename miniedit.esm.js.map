{"version":3,"file":"miniedit.esm.js","sources":["../node_modules/@ludekarts/utility-belt/dist/utility-belt.module.js","../src/shared/select.js","../src/shared/node.js","../src/shared/patterns.js","../src/toolbox/tools/basic.js","../src/utils/parsers.js","../src/shared/caret.js","../src/utils/index.js","../src/index.js","../src/styles.js","../src/utils/observer.js","../src/toolbox/index.js","../src/toolbox/factory.js","../src/toolbox/tools/link.js","../src/toolbox/tools/image.js","../src/toolbox/tools/embed.js"],"sourcesContent":["function e(e){var n={\"Ä…\":\"a\",\"Ä‡\":\"c\",\"Ä™\":\"e\",\"Å‚\":\"l\",\"Å„\":\"n\",\"Ã³\":\"o\",\"Å›\":\"s\",\"Å¼\":\"z\",\"Åº\":\"z\",\" \":\"-\"};return e.toLowerCase().replace(/[\\WÄ…Ä‡Ä™Å‚Å„Ã³Å›Å¼Åº_ ]/g,function(e){return n[e]||\"\"}).replace(/-{2,}/,\"-\")}function n(e){return!!e&&\"symbol\"!=typeof e&&\"string\"!=typeof e&&\"number\"!=typeof e&&\"boolean\"!=typeof e&&!Array.isArray(e)}function t(e,n){for(var t=e[0],r=e[1],o=!1,i=0,u=n.length-1;i<n.length;u=i++){var a=n[i][0],c=n[i][1],f=n[u][1];c>r!=f>r&&t<(n[u][0]-a)*(r-c)/(f-c)+a&&(o=!o)}return o}function r(e){var n=[2,3,4],t=[11,12,13,14];return function(r){return 1===r?e.one:!n.includes(r%10)||t.includes(r)?e.multiple:e.couple}}function o(e,n){return Math.floor(Math.random()*(n-e+1))+e}function i(){return(+new Date+100*Math.random()).toString(32)}function u(e){document.head.appendChild(document.createElement(\"style\")).textContent=e}function a(e,n){var t=n.length,r=e.length;if(r>t)return!1;if(r===t)return e===n;e:for(var o=0,i=0;o<r;o++){for(var u=e.charCodeAt(o);i<t;)if(n.charCodeAt(i++)===u)continue e;return!1}return!0}function c(e,n){return s(n)?void 0===n?e:n:Array.isArray(n)||Array.isArray(e)?l(e,n):f(e,n)}function f(e,n){if(void 0===e)return n;if(void 0===n)return e;if(null===e)return n;if(null===n)return n;var t=Object.keys(n),r=Object.keys(e),o=t.concat(r.filter(function(e){return!t.includes(e)}));return o.length?o.reduce(function(t,r){var o=n[r],i=e[r];return t[r]=s(o)?void 0===o?i:o:Array.isArray(i)||Array.isArray(o)?l(i,o):o instanceof RegExp?RegExp(o.source,o.flags):f(i,o),t},{}):e}function l(e,n){if(Array.isArray(e)&&Array.isArray(n)){for(var t=e.length,r=n.length,o=[],i=0;i<t||i<r;i++)o[i]=s(n[i])?void 0===n[i]?e[i]:n[i]:Array.isArray(e[i])||Array.isArray(n[i])?l(e[i],n[i]):f(e[i],n[i]);return o}return n}function s(e){return[\"string\",\"number\",\"boolean\",\"symbol\",\"function\",\"undefined\"].includes(typeof e)}function d(e){var n={},t=function(e){return function(t){if(t.target.dataset[e]){var r=n[t.target.dataset[e]];r&&r(t)}}};[].slice.call(arguments,1).forEach(function(n){e.addEventListener(n,t(n))});var r=function(e,t){n[e]||(n[e]=t)},o=function(e,t){n[e](t)};return Object.freeze({add:r,callHandler:o})}function h(e){var n,t=0,r=new Array(e);return Object.freeze({push:function(o){o&&(r[t]=o,n=r[t],t=(t+1)%e)},pull:function(){return n=r[t=(t-1+e)%e],r[t]=void 0,n},get:function(e){return r[e]},head:function(){return n},dump:function(){return r}})}function p(){var e=document.getElementById(\"_clipContainer_\")||document.createElement(\"textarea\");return e.id||(e.id=\"_clipContainer_\",e.style.opacity=0,e.style.position=\"fixed\",e.style.pointerEvents=\"none\",document.body.appendChild(e)),function(n){try{return e.value=n,e.select(),document.execCommand(\"copy\"),n}catch(e){return void console.error(e)}}}function v(e,n){return e.reduce(function(e,t){return e[t[n]]=t,e},{})}function m(e,n){for(var t=0,r=e.length,o=[];t<r;t+=n)o.push(e.slice(t,t+n));return o}function y(e,n){return{added:n.filter(function(n){return!~e.indexOf(n)}),removed:e.filter(function(e){return!~n.indexOf(e)})}}function g(e,n){for(var t,r,o=e.slice(0),i=e.length,u=i-n;i-- >u;)t=o[r=Math.floor((i+1)*Math.random())],o[r]=o[i],o[i]=t;return o.slice(u)}function A(e){for(var n=[],t=-1,r=e.length;++t!==r;n[t]=e[t]);return n}function b(e,n,t){for(var r=-1,o=e.length,i=o-1;++r<o;)t=n(t,e[r],r,r===i);return t}function x(e,n){for(var t=-1,r=[],o=e.length;++t<o;)!n(e[t],t)&&r.push(e[t]);return r}function E(e){for(var n,t,r=e.length;0!==r;)t=Math.floor(Math.random()*r),n=e[r-=1],e[r]=e[t],e[t]=n;return e}function w(e,n,t){void 0===t&&(t=function(e){return e});var r=n.toLowerCase();return e.sort(function(e,n){var o=t(e).indexOf(r),i=t(n).indexOf(r);return(o<0?Infinity:o)-(i<0?Infinity:i)})}function C(e,n){return e.toLowerCase().includes(n.toLowerCase())}function L(e){var n=e.extractContent,t=e.uiRender,r=e.matchFn,o=void 0===r?C:r,i=e.matchIfEmptyPhrase,a=void 0===i||i,c=A(document.querySelectorAll(e.selector)).reduce(function(e,t){return!a&&t.classList.add(\"dom-filter-match\"),e.push({text:n?n(t,index):t.textContent,ref:t}),e},[]);u(\"\\n    .dom-filter-match {\\n      display: none;\\n    }\\n  \");var f={},l=c.length;return function(e){for(var n=0;n<l;n++){var r=c[n];(e.length||a)&&o(r.text,e,c)?(r.ref.classList.remove(\"dom-filter-match\"),t&&t(r,e,f)):r.ref.classList.add(\"dom-filter-match\")}return c}}function O(e,n,t,r){return void 0===r&&(r=!1),e.addEventListener(n,t,r),function(){return e.removeEventListener(n,t,r)}}function j(){return(j=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var M=new Map;function N(e,n){void 0===n&&(n={});var t=n.fallback,r=n.freepass,o=void 0!==r&&r,i=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n.indexOf(t=i[r])>=0||(o[t]=e[t]);return o}(n,[\"fallback\",\"freepass\"]),u=new AbortController,a=u.signal,c=fetch(e,j(j({},i),{},{signal:a})).then(function(e){return M.delete(c),e}).then(function(e,n){return function(t){if(t.ok||n)return t;if(e)return console.warn(\"Request rejected: \"+t.statusText+\". Fallback applied\"),e;throw function(e){var n=Error();return n.code=e.status,n.message=e.statusText,n}(t)}}(t,o));return M.set(c,function(){u.abort()}),c}function k(e){if(e instanceof FormData)return{body:e};if(n(e)){var t=new FormData;return Object.keys(e).forEach(function(n){return t.append(n,JSON.stringify(e[n]))}),t}return e}function T(e){M.has(e)&&(M.get(e)(),M.delete(e))}function S(e){var n=e.headers.get(\"content-type\").split(\";\")[0];if(/^text\\//.test(n))return e.text();if(/^image\\//.test(n))return e.blob();switch(n){case\"application/json\":return e.json();case\"multipart/form-data\":return e.formData();default:return console.warn(\"Not recognized content-type: \"+e.headers.get(\"content-type\")),e}}var R={isNull:function(e){return null===e},isUndefined:function(e){return void 0===e},object:function(e){return n(e)},array:function(e){return Array.isArray(e)},number:function(e){return\"number\"==typeof e},string:function(e){return\"string\"==typeof e},symbol:function(e){return\"symbol\"==typeof e},boolean:function(e){return\"boolean\"==typeof e},matches:function(e){return function(n){return e.test(n)}},objectOf:function(e){return function(t){return n(t)&&{value:t,schema:e}}},arrayOf:function(e){return function(n){return Array.isArray(n)&&{value:n,schema:e}}}};function _(e,t,r){if(void 0===r&&(r={}),\"function\"==typeof t){var o=t(e);if(Array.isArray(o.value))return o.value.every(function(e){return Array.isArray(o.schema)?o.schema.some(function(n){return _(e,n,{silent:!0})}):_(e,o.schema)});if(n(o.schema))return Object.keys(o.schema).every(function(e){if(void 0===o.value[e])throw new Error('Missing property \"'+e+'\"');return _(o.value[e],o.schema[e])});if(!1===o){if(r.silent)return!1;throw new Error('Value \"'+e+'\" does not match schema type.')}return!0}throw new Error('Incorrect schema type. Got \"'+typeof t+'\" instead of ptop-type function.')}function H(e){return e&&e.length?(0===e.indexOf(\"?\")?e.slice(1):e).split(\"&\").reduce(function(e,n){var t=n.split(\"=\"),r=t[0],o=decodeURIComponent(t[1]);return e[r]?Array.isArray(e[r])?e[r].push(o):e[r]=[e[r],o]:e[r]=o,e},{}):{}}function I(e,n){var t=\"string\"==typeof e?H(e):e,r=new URLSearchParams,o=j(j({},t),n);return Object.keys(o).forEach(function(e){var n=o[e];void 0!==n&&(Array.isArray(n)?n.forEach(function(n){return r.append(e,n)}):(\"string\"!=typeof n||n.length>0)&&r.append(e,n))}),r.toString()}function q(e,n){if(!n.length)return e;for(var t,r=[],o=function(e){var n=e.split(\",\"),t=n.length>1?n.reduce(function(e,n){var t=n.trim();return t.length?\"\"+e+t+\"|\":e},\"\"):n[0]+\"|\";return new RegExp(t.slice(0,-1),\"gi\")}(n);t=o.exec(e);)r.push([t.index,t.index+t[0].length]);return r.reverse().reduce(function(e,n){var t=n[0],r=n[1];return e.slice(0,t)+\"<strong>\"+e.slice(t,r)+\"</strong>\"+e.slice(r)},e)}function F(e,n,t){var r;return function(){var o=[].slice.call(arguments),i=function(){r=null,!t&&e.apply(void 0,o)};clearTimeout(r),r=setTimeout(i,n),t&&!r&&e.apply(void 0,o)}}function z(e,n,t){var r,o=this;return function(){var i=[].slice.call(arguments),u=o;return new Promise(function(o){var a=t&&!r;clearTimeout(r),r=setTimeout(function(){r=null,t||o(e.apply(u,i))},n),a&&o(e.apply(u,i))})}}var B=function(e,n){var t,r=0;return function(){(t=new Date)-r<=n&&(e.apply(void 0,[].slice.call(arguments)),t=0),r=t}};function D(e){return document.createRange().createContextualFragment(e)}function P(e){if(!e)throw new Error(\"getNodesPath error: stopSelector is required\");return function n(t,r){return void 0===r&&(r=[t]),t.parentNode.matches(e)?r:(r.push(t.parentNode),n(t.parentNode,r))}}function U(e){var n=arguments;if(!Array.isArray(e)||!e.raw)throw new Error(\"template helper should be called as tagged template string rather than function\");var t={},r=e.reduce(function(e,r,o){var u,a=[].slice.call(n,1)[o];if(a instanceof NodeList&&(a=A(a)),a instanceof HTMLElement||Array.isArray(a)){var c=i();t[c]=a,u='<i id=\"'+c+'\" class=\"_hook_\"></i>'}else\"string\"!=typeof a&&\"number\"!=typeof a||(u=a);return\"string\"==typeof u||\"number\"==typeof u?e+(r+u):e+r},\"\"),o=document.createElement(\"div\");o.insertAdjacentHTML(\"beforeend\",r);var u=A(o.querySelectorAll(\"[ref]\")),a=u.reduce(function(e,n){return e[n.getAttribute(\"ref\")]=n,n.removeAttribute(\"ref\"),e},{});A(o.querySelectorAll(\"i._hook_\")).forEach(function(e){var n=t[e.id],r=e.parentNode;Array.isArray(n)?(n.forEach(function(n){n instanceof HTMLElement&&r.insertBefore(n,e)}),e.remove()):r.replaceChild(n,e)});var c=1===o.children.length?o.children[0]:o;return u.length?[c,a]:c}function G(e){var n=document.querySelector(\"*[data-import]\");if(!n)return e&&e();var t=n.dataset.import;n.removeAttribute(\"data-import\"),fetch(t).then(function(e){if(e.ok)return e.text();throw Error(\"Cannot import file: \"+t)}).then(function(r){n.innerHTML=r,n.dispatchEvent(new CustomEvent(\"htmlLoaded\",{bubbles:!0,detail:{file:t}})),G(e)}).catch(function(t){n.innerHTML='<strong style=\"color:red;\">Cannot import module!</strong>',console.error(t),G(e)})}function J(e,n,t){return void 0===t&&(t=!1),e&&e.classList.add(n),function(r){return t&&e&&e===r?e.classList.toggle(n):(e&&e.classList.remove(n),r&&r.classList.add(n),e=r),e}}function V(e,n){var t=e.match(/[\\w-:]+=\".+?\"/g);t&&(t=t.map(function(e){return function(e,n){return[e.substring(0,n),e.substring(n+1)]}(e.replace(/\"/g,\"\"),e.indexOf(\"=\"))}));var r,o=~e.indexOf(\"[\")?e.slice(0,e.indexOf(\"[\")):e,i=~o.indexOf(\".\")?o.split(\".\"):[o],u=i[0];if(i.length>0&&(i=i.slice(1,i.length).join(\" \")),~u.indexOf(\"#\")){var a=u.split(\"#\");u=a[0],r=a[1]}var c=document.createElement(u);return r&&(c.id=r),n&&(\"string\"==typeof n?c.innerHTML=n:n instanceof HTMLElement&&c.appendChild(n)),t&&t.forEach(function(e){return c.setAttribute(e[0],e[1])}),i&&(c.className=i),c}function W(e,n){var t=n.isModule,r=n.onComplete,o=document.createElement(\"script\");o.setAttribute(\"type\",t?\"module\":\"text/javascript\"),r&&o.addEventListener(\"load\",function e(){o.removeEventListener(\"load\",e),r()}),o.setAttribute(\"src\",e),document.head.appendChild(o)}function K(e,n,t){void 0===t&&(t=[]),Array.from(e.attributes||[]).forEach(function(e){return!~t.indexOf(e.name)&&n.setAttribute(e.name,e.value)})}function Q(e){if(0===e.childNodes.length)return e.remove();e.parentNode.insertBefore(e.firstChild,e),Q(e)}function X(e,n){n.parentNode.insertBefore(e,n.nextSibling)}function Y(e,n){n.parentNode.insertBefore(e,n)}function Z(e,n){for(;e.childNodes.length>0;)n.appendChild(e.firstChild);return n}function $(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,n){return String.fromCharCode(\"0x\"+n)}))}function ee(e){var n,t=0,r=e.length;if(0===r)return t;for(n=0;n<r;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}function ne(e){return e.split(\"\").reduce(function(e,n){return(e=(e<<5)-e+n.charCodeAt(0))&e},0)}function te(e,n){return[e.slice(0,n),e.slice(n)]}function re(e,n,t){return e.slice(0,t)+n+e.slice(t+n.length-1,e.length)}export{T as abort,v as arrayToObject,u as attachStyle,$ as base64,_ as checkSchema,m as chunksArray,p as clipboard,y as compareArrays,K as copyAttrs,V as createElement,O as createEventHandler,F as debounce,z as debouncePromise,c as deepOverride,L as domFilter,D as elFromString,d as events,Q as extractNodes,a as fuzzySearch,P as getNodesPath,g as getRandomSubarray,ee as hash32,ne as hashCode,q as highlight,e as hyphenate,G as importHtml,B as inDeltaTime,t as inPolygon,W as includeScriptTag,X as insertNodeAfter,Y as insertNodeBefore,n as isObject,h as loopstack,J as memoElement,Z as moveNodes,A as nodeListToArray,k as objectToFetchBody,S as parseResponse,r as plWordCase,re as placeBetween,H as queryToObject,o as rangeRandomInt,b as reduce,x as removeFromArray,N as request,R as schemaTypes,E as shuffleArray,w as sortByPhraseIndex,te as splitAtIndex,U as template,i as uid,I as updateQuery};\n","// Allows to select text inside single text-node.\r\nexport const selectInlineRange = (element, satrt, end) => {\r\n  const range = document.createRange();\r\n  const selection = window.getSelection();\r\n  range.setStart(element, satrt);\r\n  range.setEnd(element, end);\r\n  selection.removeAllRanges();\r\n  selection.addRange(range);\r\n  return selection;\r\n};\r\n\r\n\r\n// Selects given node.\r\nexport const selectNode = node => {\r\n  const selection = window.getSelection();\r\n  const range = selection.getRangeAt(0);\r\n  range.selectNode(node);\r\n  selection.removeAllRanges();\r\n  selection.addRange(range);\r\n  return selection;\r\n};\r\n\r\n// Selects given node with extra character before and after element.\r\nexport const selectNodeExt = node => {\r\n\r\n  // Only for block nodes;\r\n  if (node.nodeType === 3) return;\r\n\r\n  const selection = window.getSelection();\r\n  const range = selection.getRangeAt(0);\r\n\r\n  const startLength = node.previousSibling && node.previousSibling.textContent.length\r\n    ? node.previousSibling.textContent.length - 1\r\n    : 0;\r\n\r\n  const endLength = node.nextSibling && node.nextSibling.textContent.length\r\n    ? 1\r\n    : 0;\r\n\r\n  range.setStart(node.previousSibling, startLength);\r\n  range.setEnd(node.nextSibling, endLength);\r\n  selection.removeAllRanges();\r\n  selection.addRange(range);\r\n  return selection;\r\n}\r\n\r\n// Returns HTML of current selection wrapped with wrapper element.\r\nexport const selectionToHtml = (wrapper = \"div\") => {\r\n  const selection = window.getSelection();\r\n  const container = document.createElement(wrapper);\r\n  if (!selection.isCollapsed) {\r\n    const range = selection.getRangeAt(0);\r\n    container.appendChild(range.cloneContents());\r\n  }\r\n  return container;\r\n};","import { selectNodeExt, selectNode } from \"./select\";\r\n\r\n// Replaces given node with it's content.\r\nexport const unwrapNode = node => {\r\n  const zeroWidthSpaceStart = document.createTextNode(\"ï»¿\"); // &#xfeff; - ZERO WIDTH NO-BREAK SPACE\r\n  const zeroWidthSpaceEnd = document.createTextNode(\"ï»¿\"); // &#xfeff; - ZERO WIDTH NO-BREAK SPACE\r\n  insertNodeBefore(zeroWidthSpaceStart, node);\r\n  insertNodeAfter(zeroWidthSpaceEnd, node);\r\n  selectNodeExt(node);\r\n  const content = node.innerHTML.replace(/\\uFEFF/g, \"\");\r\n  document.execCommand(\"insertHTML\", false, content);\r\n}\r\n\r\n// Delete given node.\r\nexport const deleteNode = node => {\r\n  const zeroWidthSpaceStart = document.createTextNode(\"ï»¿\"); // &#xfeff; - ZERO WIDTH NO-BREAK SPACE\r\n  const zeroWidthSpaceEnd = document.createTextNode(\"ï»¿\"); // &#xfeff; - ZERO WIDTH NO-BREAK SPACE\r\n  insertNodeBefore(zeroWidthSpaceStart, node);\r\n  insertNodeAfter(zeroWidthSpaceEnd, node);\r\n  selectNodeExt(node);\r\n  document.execCommand(\"delete\");\r\n}\r\n\r\n// Replaces givern node with new content.\r\nexport const replaceNode = (node, contnent) => {\r\n  node && selectNode(node);\r\n  document.execCommand(\"insertHTML\", false, contnent);\r\n};\r\n\r\n// Exracts childNodes from @node. Removes @node at the end.\r\nexport const extractNodes = node => {\r\n  if (node.childNodes.length === 0) return node.remove();\r\n  node.parentNode.insertBefore(node.firstChild, node);\r\n  extractNodes(node);\r\n};\r\n\r\n// Move nodes @from node @to node.\r\nexport const moveNodes = (from, to) => {\r\n  while(from.childNodes.length > 0) to.appendChild(from.firstChild);\r\n  return to;\r\n};\r\n\r\n// Inserts newNode after the old one.\r\nexport const insertNodeAfter = (newNode, node) => {\r\n  node.parentNode.insertBefore(newNode, node.nextSibling);\r\n};\r\n\r\n// Inserts newNode before the old one.\r\nexport const insertNodeBefore = (newNode, node) => {\r\n  node.parentNode.insertBefore(newNode, node);\r\n};\r\n\r\n","// WARNING: Order of this rules matters!\n\nexport const headlines = {\n  \"#\": \"h1\",\n  \"##\": \"h2\",\n  \"###\": \"h3\",\n  \"####\": \"h4\",\n  \"#####\": \"h5\",\n  \"######\": \"h6\",\n};\n\n// Pure Markdown markup to HTML-nodes.\nexport const markdownToHtml = [\n  // BLOCK.\n  {\n    // Headers.\n    match: /^(#{1,6}) ([\\s\\S]+?)$/gm,\n    format: (match, head, tail) => `<${headlines[head]} data-block=\"true\" data-md=\"${head}\">${tail}</${headlines[head]}>`\n  },\n  {\n    // Comments.\n    match: /^> ([\\s\\S]+?)$/gm,\n    format: (match, content) => `<blockquote data-block=\"true\" data-md=\"quote\">${content.trim()}</blockquote>`\n  },\n  {\n    // Horizontal line.\n    match: /^--{2,}$/gm,\n    format: (match, content) => `<hr data-block=\"true\" data-md=\"line\"/>`\n  },\n\n  // INLINE.\n\n  {\n    // Lists.\n    match: /^( *-) ([\\s\\S]+?)\\n/gm,\n    format: (match, head, content) => `${head} ${content.trim()}\\n`\n  },\n  {\n    // Bold\n    match: /\\*\\*(.+?)\\*\\*/g,\n    format: (match, content) => `<strong data-md=\"bold\">${content.trim()}</strong>`\n  },\n  {\n    // Italic.\n    match: /\\*(.+?)\\*/g,\n    format: (match, content) => `<em data-md=\"italic\">${content.trim()}</em>`\n  },\n  {\n    // Strike.\n    match: /~~(.+?)~~/g,\n    format: (match, content) => `<s data-md=\"strike\">${content.trim()}</s>`\n  },\n  {\n    // Superscript.\n    match: /\\^(.+?)\\^/g,\n    format: (match, content) => `<sup data-md=\"upper\">${content.trim()}</sup>`\n  },\n  {\n    // Linked images.\n    match: /\\[!\\[(.+?)\\]\\((.+?)\\)\\]\\((.+?)\\)/gm,\n    format: (match, alt, imgUrl, url) => `<figure data-md=\"img\" data-block=\"true\" data-noedit=\"true\" data-link=\"${url}\" data-click=\"showImageOptions\"><img src=\"${imgUrl}\" alt=\"${alt}\"/></figure>`,\n  },\n  {\n    // Images and Links.\n    match: /!?\\[(.*?)\\]\\((.*?)\\)/gm,\n    format: (match, text, url) => {\n      if (match.indexOf(\"!\") === 0) {\n        return `<figure data-md=\"img\" data-block=\"true\" data-noedit=\"true\" data-click=\"showImageOptions\"><img src=\"${url}\" alt=\"${text}\"/></figure>`;\n      }\n      return `<a href=\"${url}\" data-md=\"link\">${text}</a>`;\n    }\n  },\n  {\n    // Paste image/link.\n    match: /^(http[^\\s]+)$/gm,\n    format: (match, url) => {\n      const isImage = /\\.(gif|png|jpe?g|svg|tiff)$/g.test(url);\n\n      if (isImage) {\n        return `<figure data-md=\"img\" data-block=\"true\" data-noedit=\"true\" data-click=\"showImageOptions\"><img src=\"${url}\" alt=\"figure\"/></figure>`;\n      }\n\n      if (url.includes(\"youtube.com\")) {\n        return `<figure data-md=\"embed\" data-block=\"true\" data-noedit=\"true\"data-click=\"showEmbedOptions\" data><img src=\"${formatYTCover(url)}\" alt=\"${url}\"/></figure>`\n      }\n\n      return `<a href=\"${url}\" data-md=\"link\">${cropUrl(url)}</a>`;\n    }\n  },\n  {\n    // New Lines.\n    match: /\\n/gm,\n    format: (match, content) => `<br data-md=\"nl\"/>`\n  },\n];\n\n// Regexes for Block-style elements.\nexport const block = markdownToHtml.slice(0, 3);\n\n// Regexes for Inline-style elements.\nexport const inline = markdownToHtml.slice(4, markdownToHtml.length);\n\n// List of markdown markup.\nexport const markdownMarkup = {\n  \"#\": content => `# ${content}`,\n  \"##\": content => `## ${content}`,\n  \"###\": content => `### ${content}`,\n  \"####\": content => `#### ${content}`,\n  \"#####\": content => `##### ${content}`,\n  \"######\": content => `###### ${content}`,\n  \"bold\": content => `**${content}**`,\n  \"italic\": content => `*${content}*`,\n  \"strike\": content => `~~${content}~~`,\n  \"upper\": content => `^${content}^`,\n  \"quote\": content => `> ${content}`,\n  \"line\": _ => `---`,\n  \"embed\": (url) => `[${url}](${url})`,\n  \"link\": (url, name) => `[${name}](${url})`,\n  \"img\": (url, name) => `![${name}](${url})`,\n  \"imglink\": (url, name, link) => `[![${name}](${url})](${link})`,\n};\n\n// ---- HELPERS ----------------\n\nfunction cropUrl(url) {\n  return url.length > 37 ? `${url.slice(0, 37)}...` : url;\n}\n\nfunction formatYTCover(url) {\n  const searchParams = new URLSearchParams(url.slice(url.indexOf(\"?\") + 1));\n  return `https://i3.ytimg.com/vi/${searchParams.get(\"v\")}/maxresdefault.jpg`;\n}\n","import { template } from \"@ludekarts/utility-belt\";\r\nimport { headlines } from \"../../shared/patterns\";\r\nimport { unwrapNode, replaceNode } from \"../../shared/node\";\r\n\r\nexport default function BasicEditor() {\r\n  return currentTarget => {\r\n    const [element, refs] = template`\r\n      <div class=\"toolbox-controllers\">\r\n        <div>\r\n          <button class=\"${currentTarget.dataset.md.includes(\"#\") ? \"active\" : \"\"}\" data-action=\"headlines\" title=\"NagÅ‚Ã³wki\">H</button>\r\n          <button class=\"${currentTarget.dataset.md === \"bold\" ? \"active\" : \"\"}\" data-action=\"bold\" title=\"Bold\">B</button>\r\n          <button class=\"${currentTarget.dataset.md === \"italic\" ? \"active\" : \"\"}\" data-action=\"italic\" title=\"Italic\">I</button>\r\n          <button class=\"${currentTarget.dataset.md === \"strike\" ? \"active\" : \"\"}\" data-action=\"strike\" title=\"Strike through\">S</button>\r\n          <button class=\"${currentTarget.dataset.md === \"quote\" ? \"active\" : \"\"}\" data-action=\"quote\" title=\"Blockquote\">â€Ÿ</button>\r\n          <button data-action=\"link\" title=\"Create link\">â†¸</button>\r\n          <button data-action=\"clear\" title=\"Clear styles\">â€»</button>\r\n          <button data-action=\"close\" title=\"Close toolbox\">âœ–</button>\r\n        </div>\r\n        <div ref=\"headlines\" class=\"headlines\">\r\n          <button class=\"${currentTarget.dataset.md === \"#\" ? \"active\" : \"\"}\" data-action=\"#\" title=\"Headline 1\">H1</button>\r\n          <button class=\"${currentTarget.dataset.md === \"##\" ? \"active\" : \"\"}\" data-action=\"##\" title=\"Headline 2\">H2</button>\r\n          <button class=\"${currentTarget.dataset.md === \"###\" ? \"active\" : \"\"}\" data-action=\"###\" title=\"Headline 3\">H3</button>\r\n          <button class=\"${currentTarget.dataset.md === \"####\" ? \"active\" : \"\"}\" data-action=\"####\" title=\"Headline 4\">H4</button>\r\n          <button class=\"${currentTarget.dataset.md === \"#####\" ? \"active\" : \"\"}\" data-action=\"#####\" title=\"Headline 5\">H5</button>\r\n          <button class=\"${currentTarget.dataset.md === \"######\" ? \"active\" : \"\"}\" data-action=\"######\" title=\"Headline 6\">H6</button>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n\r\n    // ---- Methods ------------\r\n\r\n    function unwrapElement() {\r\n      if (currentTarget.nodeType === 1) {\r\n        !currentTarget.parentNode\r\n          ? document.execCommand(\"insertHTML\", false, currentTarget.textContent)\r\n          : unwrapNode(currentTarget);\r\n      }\r\n    }\r\n\r\n    function toggleHeadlines() {\r\n      refs.headlines.classList.toggle(\"active\");\r\n    }\r\n\r\n    function updateHeadline(size) {\r\n      insertNode(\r\n        currentTarget,\r\n        `<${headlines[size]} data-md=\"${size}\">${currentTarget.innerHTML}</${headlines[size]}>`\r\n      );\r\n    }\r\n\r\n    function boldElement() {\r\n      insertNode(\r\n        currentTarget,\r\n        `<strong data-md=\"bold\">${currentTarget.innerHTML}</strong>`\r\n      );\r\n    }\r\n\r\n    function italicElement() {\r\n      insertNode(\r\n        currentTarget,\r\n        `<em data-md=\"italic\">${currentTarget.innerHTML}</em>`\r\n      );\r\n    }\r\n\r\n    function strikeElement() {\r\n      insertNode(\r\n        currentTarget,\r\n        `<s data-md=\"strike\">${currentTarget.innerHTML}</s>`\r\n      );\r\n    }\r\n\r\n    function quoteElement() {\r\n      insertNode(\r\n        currentTarget,\r\n        `<blockquote data-block=\"true\" data-md=\"quote\">${currentTarget.innerHTML}</blockquote>`\r\n      );\r\n    }\r\n\r\n    function linkElement() {\r\n      insertNode(\r\n        currentTarget,\r\n        `<a data-md=\"link\" href=\"\">${currentTarget.innerHTML}</a>`\r\n      );\r\n    }\r\n\r\n\r\n    // ---- API ----------------\r\n\r\n    return {\r\n      element,\r\n      command: cmd => {\r\n        switch (cmd) {\r\n          case \"headlines\":\r\n            toggleHeadlines();\r\n            return true; // Do not close toolbox.\r\n\r\n          case \"bold\":\r\n            boldElement();\r\n            break;\r\n\r\n          case \"italic\":\r\n            italicElement();\r\n            break;\r\n\r\n          case \"strike\":\r\n            strikeElement();\r\n            break;\r\n\r\n          case \"quote\":\r\n            quoteElement();\r\n            break;\r\n\r\n          case \"link\":\r\n            linkElement();\r\n            break;\r\n\r\n          case \"clear\":\r\n            unwrapElement();\r\n            break;\r\n\r\n          default:\r\n            // Handle all headlines.\r\n            updateHeadline(cmd);\r\n            break;\r\n        }\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n// ---- Helpers ----------------\r\n\r\nfunction insertNode(target, markup) {\r\n  replaceNode(\r\n    target.parentNode ? target : null, // Enable transforming selections.\r\n    markup,\r\n  );\r\n}","import { markdownToHtml, markdownMarkup } from \"../shared/patterns\";\r\n\r\nexport function extractMarkdown(container) {\r\n  return Array.from(container.childNodes).reduce((acc, node) => {\r\n    // Text nodes.\r\n    if (node.nodeType === 3) {\r\n      acc += node.textContent\r\n    // Line breakes.\r\n    } else if (node.nodeName === \"BR\") {\r\n      acc += \"\\n\";\r\n    // Images.\r\n    } else if (node.nodeName === \"FIGURE\") {\r\n      if (node.dataset.md === \"embed\")  {\r\n        // Embed covers.\r\n        acc += markdownMarkup.embed(node.firstElementChild.alt);\r\n      } else if (node.dataset.link) {\r\n        // Linked images.\r\n        acc += markdownMarkup.imglink(node.firstElementChild.src, node.firstElementChild.alt, node.dataset.link);\r\n      } else {\r\n        // Reular images.\r\n        acc += markdownMarkup.img(node.firstElementChild.src, node.firstElementChild.alt);\r\n      }\r\n    // Links.\r\n    } else if (node.nodeName === \"A\") {\r\n      acc += markdownMarkup.link(node.href, extractMarkdown(node));\r\n    // Nested elements.\r\n    } else {\r\n      const transform = markdownMarkup[node.dataset.md];\r\n      acc += transform ? transform(extractMarkdown(node)) : node.textContent;\r\n    }\r\n    return acc;\r\n  }, \"\");\r\n}\r\n\r\n\r\n// PARSE MARKDOWN TO HTML-NODES.\r\nexport function parseMarkdown(markdown) {\r\n  return markdownToHtml.reduce(\r\n    (acc, pattern) => acc.replace(pattern.match, pattern.format)\r\n  , markdown);\r\n}\r\n","// Caret utilities.\r\n\r\n// Returns current text-node that contains edit caret.\r\nexport const getCaretNode = () => {\r\n  return window.getSelection().anchorNode;\r\n};\r\n\r\n// Returns carret position in given node.\r\nexport const getCaretPosition = node => {\r\n  const selection = window.getSelection();\r\n  const range = selection.getRangeAt(0);\r\n  const clonedRange = range.cloneRange();\r\n  clonedRange.selectNodeContents(node);\r\n  clonedRange.setEnd(range.endContainer, range.endOffset);\r\n  const position = clonedRange.toString().trim().length;\r\n  clonedRange.detach();\r\n  return position;\r\n};\r\n\r\n// Insert caret at given index insinde node.\r\nexport const caretAtIndex = (node, position) => {\r\n  const range = document.createRange();\r\n  const selection = window.getSelection();\r\n  range.setStart(node, position);\r\n  range.setEnd(node, position);\r\n  range.collapse(true);\r\n  selection.removeAllRanges();\r\n  selection.addRange(range);\r\n  return selection;\r\n};\r\n\r\n// Places caret after given node.\r\nexport const caretAfterNode = node => {\r\n  const range = document.createRange();\r\n  const selection = window.getSelection();\r\n  range.setStartAfter(node);\r\n  range.setEndAfter(node);\r\n  range.collapse(true);\r\n  selection.removeAllRanges();\r\n  selection.addRange(range);\r\n  return selection;\r\n};\r\n\r\n// Places caret before given node.\r\nexport const caretBeforeNode = node => {\r\n  const range = document.createRange();\r\n  const selection = window.getSelection();\r\n  range.setStartBefore(node);\r\n  range.setEndBefore(node);\r\n  range.collapse(true);\r\n  selection.removeAllRanges();\r\n  selection.addRange(range);\r\n  return selection;\r\n};\r\n\r\n// Places caret at the end of given node.\r\nexport const caretToEnd = node => {\r\n  const range = document.createRange();\r\n  const selection = window.getSelection();\r\n  const element = node.nodeType === 3 ? node : node.lastChild;\r\n  range.setStart(element, element.textContent.length);\r\n  range.setEnd(element, element.textContent.length);\r\n  selection.removeAllRanges();\r\n  selection.addRange(range);\r\n  return selection;\r\n};\r\n\r\n// Places caret at the begining of given node.\r\nexport const caretToStart = node => {\r\n  const range = document.createRange();\r\n  const selection = window.getSelection();\r\n  range.setStart(node, 0);\r\n  range.setEnd(node, 0);\r\n  selection.removeAllRanges();\r\n  selection.addRange(range);\r\n  return selection;\r\n};\r\n\r\n","import { selectInlineRange } from \"../shared/select\";\r\nimport { getCaretNode, getCaretPosition, caretAtIndex } from \"../shared/caret\";\r\n\r\n// Debounce given callback with provided delay.\r\nexport const debounce = (callback, delay) => {\r\n  let timeout;\r\n  return (...args) => {\r\n    const later = () => {\r\n      timeout = null;\r\n      callback.apply(this, args);\r\n    };\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, delay);\r\n  };\r\n};\r\n\r\n// Find given @pattern in @element (which should be a text node).\r\nexport const transform = (element, pattern, format) => {\r\n  let match;\r\n  if (!element) return;\r\n  while (match = pattern.exec(element.textContent)) {\r\n    selectInlineRange(element, match.index, pattern.lastIndex);\r\n    document.execCommand(\"insertHTML\", false, format(...match));\r\n  }\r\n};\r\n\r\n// Revmoe and place caret in the same possition - this resets browser current caret style e.g. Bold.\r\nexport const resetCurrentCaretStyle = () => {\r\n  const node = getCaretNode();\r\n  caretAtIndex(node, getCaretPosition(node));\r\n};\r\n\r\n// Chrome hack for adding styled nodes at the end of the block elements.\r\nexport const chromeEolHack = insertCallback => {\r\n  const node = getCaretNode();\r\n  const eol = node.parentNode.dataset.block\r\n    && getCaretPosition(node) === node.textContent.length\r\n    && document.createTextNode(\"#\");\r\n\r\n  eol && node.parentNode.appendChild(eol);\r\n  insertCallback();\r\n  eol && eol.remove();\r\n};\r\n\r\n// Add style tag to the document.\r\nexport const attachStyle = style => {\r\n  document.head.appendChild(\r\n    document.createElement(\"style\")\r\n  ).textContent = style;\r\n}","import Toolbox from \"./toolbox\";\r\nimport oberver from \"./utils/observer\";\r\nimport { markdownToHtml } from \"./shared/patterns\";\r\nimport { unwrapNode, deleteNode } from \"./shared/node\";\r\nimport { selectNode, selectionToHtml } from \"./shared/select\";\r\nimport { parseMarkdown, extractMarkdown } from \"./utils/parsers\";\r\nimport { getCaretNode,  getCaretPosition, caretToStart, caretAfterNode, caretBeforeNode } from \"./shared/caret\";\r\nimport { debounce, chromeEolHack, transform, resetCurrentCaretStyle, attachStyle } from \"./utils\";\r\n\r\n// Styles.\r\nimport createStyles from \"./styles.js\";\r\n\r\n// Core.\r\nexport default function MiniEdit(selector, namespace) {\r\n\r\n  // Attach CSS styles.\r\n  attachStyle(createStyles(namespace));\r\n\r\n  // Global referenes.\r\n  let undoMode = false;\r\n  let selectedBlock = null;\r\n  let selectionMenuLock = false;\r\n\r\n  // Set main content container.\r\n  let content = selector instanceof HTMLElement\r\n    ? selector\r\n    : document.querySelector(selector);\r\n\r\n  content.dataset.block = \"true\";\r\n  content.dataset.miniedit = \"ðŸ§±\";\r\n  content.setAttribute(\"contenteditable\", true);\r\n  content.focus();\r\n\r\n  // Initialize inline toolboxes.\r\n  const toolbox = Toolbox(content);\r\n\r\n  // Render after each keyboard sequence.\r\n  const render = debounce(() => {\r\n    const text = getCaretNode();\r\n    chromeEolHack(() => {\r\n      markdownToHtml.forEach(\r\n        pattern => transform(text, pattern.match, pattern.format),\r\n      );\r\n    });\r\n  }, 300);\r\n\r\n\r\n  // Activate text selection-toolbox.\r\n  content.addEventListener(\"mousedown\", event => {\r\n    // Show select toolbox.\r\n    if ((event.ctrlKey || event.metaKey) && window.getSelection().toString().length) {\r\n      selectionMenuLock = true;\r\n      event.preventDefault();\r\n      toolbox.selection();\r\n    }\r\n  });\r\n\r\n\r\n  // Handle Clicks.\r\n  content.addEventListener(\"click\", event => {\r\n    selectedBlock = null;\r\n\r\n    // Allow selection-toolbox to be use inside other elements and to no be close when selecting pure text.\r\n    if (!selectionMenuLock) {\r\n      // Handle ckicks on non-editabe elments.\r\n      if (event.target.dataset.noedit) {\r\n        event.preventDefault();\r\n        selectNode(event.target);\r\n        selectedBlock = event.target;\r\n        (event.ctrlKey || event.metaKey) && toolbox.open(event.target);\r\n        return;\r\n      // Show dedicated toolbox.\r\n      } else if (event.target.dataset && event.target.dataset.md && (event.ctrlKey || event.metaKey)) {\r\n        event.stopPropagation();\r\n        toolbox.open(event.target);\r\n        return;\r\n      }\r\n      toolbox.close();\r\n    }\r\n\r\n    selectionMenuLock = false;\r\n  });\r\n\r\n\r\n  // Handle KEYBOARD.\r\n  content.addEventListener(\"keydown\", event => {\r\n\r\n    // Remvoe selected noneditable block.\r\n    if (selectedBlock && !event.code.includes(\"Arrow\") && !(event.ctrlKey || event.metaKey)) {\r\n      deleteNode(selectedBlock);\r\n    }\r\n\r\n    selectedBlock = null;\r\n\r\n    // ENTER.\r\n    if (event.code === \"Enter\") {\r\n      event.preventDefault();\r\n\r\n      const text = getCaretNode();\r\n      const node = text.parentNode;\r\n      // console.log(text, node);\r\n\r\n      // Prevent from breaking non-text nodes.\r\n      if (node.dataset.md) {\r\n        getCaretPosition(text) === 0\r\n          // If carret at the begining insert enter before node.\r\n          ? caretBeforeNode(node.previousSibling)\r\n          // Insert enter after node.\r\n          : caretAfterNode(node);\r\n      }\r\n\r\n      // Insert custom Line Break\r\n      document.execCommand(\"insertHTML\", false, `<br data-md=\"nl\"/>&#8203;`);\r\n      return;\r\n    }\r\n\r\n    // Ctrl/Command + Space.\r\n    if ((event.ctrlKey || event.metaKey) && event.code === \"Space\") {\r\n      const text = getCaretNode();\r\n      const node = text.parentNode;\r\n      const range = window.getSelection().getRangeAt(0);\r\n      range.selectNode(node);\r\n      document.execCommand(\"insertHTML\", false, `${node.outerHTML} `);\r\n      return;\r\n    }\r\n\r\n    // Backspace.\r\n    if (event.code === \"Backspace\") {\r\n      // const text = getCaretNode();\r\n      const selection = window.getSelection().toString().length;\r\n\r\n      // Code below removes text and associated styles when user selects entire\r\n      // styled text node (e.g. strong) and removes it with Backspace key.\r\n      if (selection > 0) {\r\n        event.preventDefault();\r\n        document.execCommand(\"delete\");\r\n        resetCurrentCaretStyle();\r\n        return;\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    // Delete.\r\n    if (event.code === \"Delete\") {\r\n\r\n      const text = getCaretNode();\r\n      const selection = window.getSelection()\r\n      const nonZeroSelection = selection.toString().length > 0;\r\n\r\n      // Code below removes text and associated styles when user selects entire\r\n      // styled text node (e.g. strong) and removes it with Delete key.\r\n      if (nonZeroSelection) {\r\n        event.preventDefault();\r\n        document.execCommand(\"delete\");\r\n        resetCurrentCaretStyle();\r\n        return;\r\n      }\r\n\r\n      // At the END of text node.\r\n      if (getCaretPosition(text) === text.textContent.length) {\r\n        // Do not merge node styles when using Backspace.\r\n        if (text.nextElementSibling && text.nextElementSibling.dataset.block) {\r\n          event.preventDefault();\r\n          caretToStart(text.nextElementSibling);\r\n        }\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Ctrl + Z.\r\n    if (event.code === \"KeyZ\" && (event.ctrlKey || event.metaKey)) {\r\n      // Do not render - allow to get back to the moment when markdown haven't been yet converted into node.\r\n      undoMode = true;\r\n      return;\r\n    }\r\n\r\n    if ((event.ctrlKey || event.metaKey) && (event.code === \"KeyB\" || event.code === \"KeyI\")) {\r\n      return event.preventDefault();\r\n    }\r\n\r\n    // Display markdown code.\r\n    if (event.code === \"F2\") {\r\n      return console.log(extractMarkdown(content));\r\n    }\r\n\r\n    // Unwrap caret node.\r\n    if (event.code === \"F4\") {\r\n      const node = getCaretNode();\r\n      chromeEolHack(() => {\r\n        unwrapNode(node.parentNode);\r\n      })\r\n      return;\r\n    }\r\n\r\n    // Do not allow input text into noneditable nodes + select node.\r\n    const node = getCaretNode();\r\n    if (node.dataset && node.dataset.noedit) {\r\n      event.preventDefault();\r\n\r\n      if (event.code === \"ArrowDown\" || event.code === \"ArrowRight\") {\r\n        caretAfterNode(node.nextSibling);\r\n      } else if (event.code === \"ArrowUp\" || event.code === \"ArrowLeft\") {\r\n        caretBeforeNode(node.previousSibling);\r\n      }\r\n\r\n      selectNode(node);\r\n      selectedBlock = node;\r\n    }\r\n\r\n    // Reset UndoMode.\r\n    undoMode = false;\r\n\r\n    // Rnder inline markdown.\r\n    render();\r\n  });\r\n\r\n  // Prevent Drag & Drop.\r\n  content.addEventListener(\"drag\", event => {\r\n    event.preventDefault();\r\n  });\r\n\r\n  content.addEventListener(\"dragover\", event => {\r\n    event.preventDefault();\r\n  })\r\n\r\n  // CLIPBOARD.\r\n  content.addEventListener(\"copy\", event => {\r\n    event.preventDefault();\r\n    event.clipboardData.setData(\"text/plain\", extractMarkdown(selectionToHtml()));\r\n  });\r\n\r\n  content.addEventListener(\"cut\", event => {\r\n    event.preventDefault();\r\n    event.clipboardData.setData(\"text/plain\", extractMarkdown(selectionToHtml()));\r\n    document.execCommand(\"delete\");\r\n  });\r\n\r\n  content.addEventListener(\"paste\", event => {\r\n    event.preventDefault();\r\n    const node = getCaretNode();\r\n\r\n    if (node !== content && !node.parentNode.dataset.block) {\r\n      // Do not allow for pasting formatted content into inline nodes.\r\n      const container = document.createElement(\"div\");\r\n      container.innerHTML = parseMarkdown(event.clipboardData.getData(\"text/plain\"));\r\n      document.execCommand(\"insertHTML\", false, container.textContent);\r\n    } else {\r\n      // Paste formatted content.\r\n      chromeEolHack(() => {\r\n        document.execCommand(\"insertHTML\", false, parseMarkdown(\r\n          event.clipboardData.getData(\"text/plain\")\r\n        ));\r\n      });\r\n    }\r\n  });\r\n\r\n  // DOM clenup.\r\n  oberver(content, addedNode => {\r\n    // Remove artefacts after custom empty line brake.\r\n    if (/^\\u200B/g.test(addedNode.textContent)) {\r\n      addedNode.remove();\r\n      return;\r\n    }\r\n    // Remove artefacts after undo unwrapNode.\r\n    if (/^\\uFEFF/g.test(addedNode.textContent) && undoMode) {\r\n      addedNode.remove();\r\n      return;\r\n    }\r\n  });\r\n\r\n  // ---- API ----------------\r\n\r\n  return Object.freeze({\r\n    setText: text => {\r\n      content.innerHTML = parseMarkdown(text);\r\n    },\r\n\r\n    insertText: text => {\r\n      chromeEolHack(() => {\r\n        document.execCommand(\"insertHTML\", false, parseMarkdown(text));\r\n      });\r\n    },\r\n\r\n    getText: () => {\r\n      return extractMarkdown(content);\r\n    }\r\n  });\r\n}\r\n","export default function createStyles(namespace = \"\") {\r\n  return `\r\n    *[data-miniedit]$NS:focus {\r\n      outline: none;\r\n    }\r\n\r\n    *[data-miniedit]$NS h1,\r\n    *[data-miniedit]$NS h2,\r\n    *[data-miniedit]$NS h3,\r\n    *[data-miniedit]$NS h4,\r\n    *[data-miniedit]$NS h5,\r\n    *[data-miniedit]$NS h6 {\r\n      display: inline-block;\r\n    }\r\n\r\n    *[data-miniedit]$NS h1[data-md=\"#\"] {\r\n      font-weight: 600;\r\n      font-size: 1.8em;\r\n      line-height: 1.2em;\r\n    }\r\n\r\n    *[data-miniedit]$NS h2[data-md=\"##\"] {\r\n      font-weight: 600;\r\n      font-size: 1.6em;\r\n      line-height: 1.2em;\r\n    }\r\n\r\n    *[data-miniedit]$NS h3[data-md=\"###\"] {\r\n      font-weight: 600;\r\n      font-size: 1.4em;\r\n      line-height: 1.2em;\r\n    }\r\n\r\n    *[data-miniedit]$NS h4[data-md=\"####\"] {\r\n      font-size: 1em;\r\n      margin: 0.5em 0;\r\n      font-weight: bold;\r\n      line-height: 1.2em;\r\n    }\r\n\r\n    *[data-miniedit]$NS blockquote[data-md=\"quote\"] {\r\n      margin: 0;\r\n      width: 100%;\r\n      padding: 0.3em 1em;\r\n      display: inline-block;\r\n      background-color: #eee;\r\n    }\r\n\r\n    *[data-miniedit]$NS figure[data-md=\"img\"],\r\n    *[data-miniedit]$NS figure[data-md=\"embed\"] {\r\n      margin: 0;\r\n      overflow: hidden;\r\n      position: relative;\r\n      display: inline-block;\r\n    }\r\n\r\n    *[data-miniedit]$NS figure[data-md=\"embed\"]::before {\r\n      top: 50%;\r\n      left: 50%;\r\n      width: 0;\r\n      height: 0;\r\n      content: \"\";\r\n      z-index: 10;\r\n      margin-left: 5px;\r\n      position: absolute;\r\n      border-top: 25px solid transparent;\r\n      border-bottom: 25px solid transparent;\r\n      border-left: 35px solid rgba(0,0,0,0.85);\r\n      transform: translateX(-50%) translateY(-50%);\r\n    }\r\n\r\n    *[data-miniedit]$NS figure[data-md=\"embed\"]::after {\r\n      top: 50%;\r\n      left: 50%;\r\n      z-index: 10;\r\n      content: \"\";\r\n      width: 110px;\r\n      height: 110px;\r\n      position: absolute;\r\n      border-radius: 50%;\r\n      border: 10px solid rgba(0,0,0,0.85);\r\n      transform: translateX(-50%) translateY(-50%);\r\n    }\r\n\r\n    *[data-miniedit]$NS figure[data-md=\"img\"] > *,\r\n    *[data-miniedit]$NS figure[data-md=\"embed\"] > * {\r\n      pointer-events: none;\r\n    }\r\n\r\n    *[data-miniedit]$NS figure[data-md=\"img\"] > img,\r\n    *[data-miniedit]$NS figure[data-md=\"embed\"] > img {\r\n      height: auto;\r\n      display: block;\r\n      max-width: 100%;\r\n      margin: 1em auto;\r\n    }\r\n\r\n    *[data-miniedit]$NS a[data-md=\"link\"] {\r\n      text-decoration:none;\r\n    }\r\n\r\n    *[data-miniedit]$NS a[data-md=\"link\"]:hover {\r\n      text-decoration: underline;\r\n    }\r\n\r\n    *[data-miniedit]$NS hr[data-md=\"line\"] {\r\n      width: 100%;\r\n      height: 1px;\r\n      border: none;\r\n      margin: 1.2em 0;\r\n      display: inline-block;\r\n      border-bottom: 1px solid #ccc;\r\n    }\r\n\r\n    /* TOOLBOX */\r\n\r\n    div[data-miniedit-toolbox] {\r\n      opacity: 0;\r\n      padding: 5px;\r\n      z-index: 3500;\r\n      position: fixed;\r\n      overflow: hidden;\r\n      visibility: hidden;\r\n      border-radius: 3px;\r\n      transform: translateZ(0);\r\n      background-image: linear-gradient(to bottom, rgba(49,49,47,.99), #262625);\r\n      transition: visibility 0s linear 0.3s, opacity .3s ease, top .4s ease, left .4s ease, transform .3s ease;\r\n    }\r\n\r\n    div[data-miniedit-toolbox].active {\r\n      opacity: 1;\r\n      visibility: visible;\r\n      transform: translateZ(0);\r\n      transition: opacity .3s ease, visibility 0s, top .4s ease, left .4s ease, transform .3s ease;\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .toolbox-controllers .headlines {\r\n      display: none;\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .toolbox-controllers .headlines.active {\r\n      display: block;\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .toolbox-controllers button {\r\n      width: 30px;\r\n      height: 30px;\r\n      border: none;\r\n      color: white;\r\n      background: none;\r\n      font-weight: 500;\r\n      position: relative;\r\n      display: inline-block;\r\n      transition: box-shadow .3s ease;\r\n      box-shadow: rgba(29, 100, 224, 0) 0px -2px 0px 0px inset;\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .toolbox-controllers button > * {\r\n      pointer-events: none;\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .toolbox-controllers button:hover,\r\n    div[data-miniedit-toolbox] .toolbox-controllers button:focus {\r\n      outline: none;\r\n      box-shadow: rgb(29, 100, 224) 0px -2px 0px 0px inset;\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .toolbox-controllers button.active::before {\r\n      top: 2px;\r\n      left: 2px;\r\n      right: 2px;\r\n      bottom: 2px;\r\n      content: \"\";\r\n      border-radius: 4px;\r\n      position: absolute;\r\n      background-color: rgba(0,0,0,0.2);\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .toolbox-controllers button.active::after {\r\n      top: 3px;\r\n      right: 3px;\r\n      width: 5px;\r\n      height: 5px;\r\n      content: \"\";\r\n      border-radius: 50%;\r\n      position: absolute;\r\n      background-color: #dc3c09;\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .toolbox-controllers button.pressable:active {\r\n      transform: scale(0.8);\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .list {\r\n      display: flex;\r\n      flex-direction: column;\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .justify-right {\r\n      display: flex;\r\n      width: 100%;\r\n      justify-content: flex-end;\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .link input {\r\n      border: none;\r\n      padding: 3px;\r\n      color: white;\r\n      background: none;\r\n      transition: box-shadow .3s ease;\r\n      box-shadow: rgba(29, 100, 224, 0) 0px -2px 0px 0px inset;\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .link input:hover,\r\n    div[data-miniedit-toolbox] .link input:focus {\r\n      outline: none;\r\n      box-shadow: rgb(29, 100, 224) 0px -2px 0px 0px inset;\r\n    }\r\n\r\n    div[data-miniedit-toolbox] .link input.url {\r\n      color: #337ab7;\r\n    }\r\n  `.replace(/\\$NS/g, namespace);\r\n}","\r\n// Observes givent node for node-add-event, and runs calback on that event.\r\nexport default function observer(observeNode, callback) {\r\n  // Create an observer instance linked to the callback function\r\n  const observer = new MutationObserver((mutationsList, observerRef) => {\r\n    for (let mutation of mutationsList) {\r\n      if (mutation.type === \"childList\" && mutation.addedNodes[0]) {\r\n         callback(mutation.addedNodes[0]);\r\n      }\r\n    }\r\n  });\r\n\r\n  // Start observing the target node for configured mutations\r\n  observer.observe(observeNode, {\r\n    subtree: true,\r\n    childList: true,\r\n    characterData: false,\r\n  });\r\n}","import { createElement } from \"@ludekarts/utility-belt\";\r\nimport { selectionToHtml } from \"../shared/select\";\r\nimport factory from \"./factory\";\r\n\r\nexport default function Toolbox(content) {\r\n\r\n  // Currently selected tool.\r\n  let currentTool;\r\n\r\n  // Current element that tool is operating on.\r\n  let currentTarget;\r\n\r\n  // Initialization.\r\n  const toolsFactory = factory();\r\n  const element = createElement(`div[data-miniedit-toolbox=\"ðŸ§°\"]`);\r\n\r\n  content.parentNode.appendChild(element);\r\n\r\n  // Toolbox core.\r\n  function showToolbox() {\r\n\r\n    // Get current editor instance.\r\n    const editor = toolsFactory.getEditor(currentTarget.dataset.md, currentTarget);\r\n    installTool(editor);\r\n\r\n    // Set toolbox coordinates.\r\n    const {x, y, width} = getTargetPosition(currentTarget);\r\n    element.style.top = `${y - element.offsetHeight - 25}px`;\r\n    element.style.left = `${(x + width)/2 + editor.element.offsetWidth/2}px`;\r\n    element.classList.add(\"active\");\r\n\r\n    // Set listeners for close events.\r\n    window.addEventListener(\"scroll\", watchForClose);\r\n  }\r\n\r\n  function watchForClose(event) {\r\n    if (!element.contains(event.target)) {\r\n      window.removeEventListener(\"scroll\", watchForClose);\r\n      element.classList.remove(\"active\");\r\n      currentTarget = null;\r\n    }\r\n  }\r\n\r\n  function installTool(tool) {\r\n    element.innerHTML = \"\";\r\n    element.appendChild(tool.element);\r\n    currentTool = tool;\r\n  }\r\n\r\n  function closeToolbox() {\r\n    element.classList.remove(\"active\");\r\n  }\r\n\r\n  // Handle tools internal buttons events -> to unified actions handling among all tools & simplify tool code.\r\n  element.addEventListener(\"click\", event => {\r\n    // Discard all irrelevant clicks.\r\n    if (!event.target.dataset || !event.target.dataset.action) return;\r\n    // Default close action for all tools.\r\n    if (event.target.dataset.action === \"close\") return closeToolbox();\r\n    // Run given command in currentTool and close toolbox.\r\n    if (currentTool) {\r\n      // NOTE: If command returns \"true\" tollbox will NOT CLOSE by default.\r\n      !currentTool.command(event.target.dataset.action) && closeToolbox();\r\n    }\r\n  })\r\n\r\n  // ---- API ----------------\r\n\r\n  return Object.freeze({\r\n    open(target) {\r\n      currentTarget = target;\r\n      showToolbox();\r\n    },\r\n\r\n    close() {\r\n      currentTarget = null;\r\n      closeToolbox();\r\n    },\r\n\r\n    selection() {\r\n      const selectedHtml = selectionToHtml();\r\n      selectedHtml.dataset.md = \"selection\";\r\n      currentTarget = selectedHtml;\r\n      showToolbox();\r\n    }\r\n  });\r\n}\r\n\r\n// ---- Helpers\r\n\r\nfunction getTargetPosition(target) {\r\n  return target.dataset.md === \"selection\"\r\n    ? window.getSelection().getRangeAt(0).getBoundingClientRect()\r\n    : target.getBoundingClientRect();\r\n}","import LinkEditor from \"./tools/link\";\r\nimport BasicEditor from \"./tools/basic\";\r\nimport ImageEditor from \"./tools/image\";\r\nimport EmbedEditor from \"./tools/embed\";\r\n\r\nexport default function ToolsFactory() {\r\n\r\n  const link = LinkEditor();\r\n  const basic = BasicEditor();\r\n  const embed = EmbedEditor();\r\n  const image = ImageEditor();\r\n\r\n  const editors = {\r\n    \"italic\" : basic,\r\n    \"strong\" : basic,\r\n    \"strike\" : basic,\r\n\r\n    \"#\" : basic,\r\n    \"##\" : basic,\r\n    \"###\" : basic,\r\n    \"####\" : basic,\r\n    \"#####\" : basic,\r\n    \"######\" : basic,\r\n\r\n    \"quote\": basic,\r\n    \"upper\": basic,\r\n    \"line\": basic,\r\n\r\n    \"link\": link,\r\n\r\n    \"img\": image,\r\n    \"embed\": embed,\r\n  };\r\n\r\n  return {\r\n    getEditor: (type, target) => {\r\n      const editor = editors[type] || basic;\r\n      return editor(target);\r\n    },\r\n  };\r\n}","import { template } from \"@ludekarts/utility-belt\";\r\nimport { unwrapNode, replaceNode } from \"../../shared/node\";\r\n\r\nexport default function LinkEditor() {\r\n  return currentTarget => {\r\n    const [element, refs] = template`\r\n      <div class=\"toolbox-controllers\">\r\n        <div class=\"link list\">\r\n          <input ref=\"name\" class=\"name\" type=\"text\" placeholder=\"Link Name\">\r\n          <input ref=\"url\" class=\"url\" type=\"text\" placeholder=\"Link URL\">\r\n        </div>\r\n        <div>\r\n          <button data-action=\"update\" title=\"Update link\">\r\n            <i class=\"fa fa-check\">âœ”</i>\r\n          </button>\r\n          <button data-action=\"follow\" title=\"Follow link\"\">\r\n            <i class=\"fa fa-send\">â†—</i>\r\n          </button>\r\n          <button data-action=\"copy\" title=\"Copy link\">\r\n            <i class=\"fa fa-clipboard\">â</i>\r\n          </button>\r\n          <button data-action=\"clear\" title=\"Clear styles\">\r\n            <i class=\"fa fa-eraser\">â€»</i>\r\n          </button>\r\n          <button data-action=\"close\" title=\"Close toolbox\">\r\n            <i class=\"fa fa-times\">âœ–</i>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    refs.url.value = currentTarget.href;\r\n    refs.name.value = currentTarget.textContent;\r\n\r\n\r\n    // ---- Methods ------------\r\n\r\n    function unwrapElement() {\r\n      if (currentTarget.nodeType === 1) {\r\n        unwrapNode(currentTarget);\r\n      }\r\n    }\r\n\r\n    function updateTarget() {\r\n      replaceNode(\r\n        currentTarget,\r\n        `<a href=\"${refs.url.value}\" data-md=\"link\">${refs.name.value}</a>`,\r\n      );\r\n    }\r\n\r\n    function followLink() {\r\n      window.open(currentTarget.href, \"_blank\");\r\n    }\r\n\r\n    function copyLink() {\r\n      refs.url.select();\r\n      document.execCommand(\"copy\");\r\n      refs.url.blur();\r\n    }\r\n\r\n    // ---- API ----------------\r\n\r\n    return {\r\n      element,\r\n      command: cmd => {\r\n        switch (cmd) {\r\n          case \"update\":\r\n            updateTarget();\r\n            return;\r\n\r\n          case \"clear\":\r\n            unwrapElement();\r\n            return;\r\n\r\n          case \"follow\":\r\n            followLink();\r\n            return true;\r\n\r\n          case \"copy\":\r\n            copyLink();\r\n            return true;\r\n\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n    };\r\n  };\r\n}\r\n","import { template } from \"@ludekarts/utility-belt\";\r\nimport { selectNodeExt } from \"../../shared/select\";\r\n\r\nexport default function ImageEditor() {\r\n  return currentTarget => {\r\n    const [element, refs] = template`\r\n      <div class=\"toolbox-controllers\">\r\n        <div class=\"link list\">\r\n          <input ref=\"alt\" class=\"name\" type=\"text\" placeholder=\"Image alt text\">\r\n          <input ref=\"url\" class=\"name\" type=\"text\" placeholder=\"Image URL\">\r\n          <input ref=\"link\" class=\"name\" type=\"text\" placeholder=\"External URL\">\r\n        </div>\r\n        <div>\r\n          <button data-action=\"update\" title=\"Update image\">\r\n            <i class=\"fa fa-check\">âœ”</i>\r\n          </button>\r\n          <button data-action=\"copy\" title=\"Copy link\"\">\r\n            <i class=\"fa fa-clipboard\">â</i>\r\n          </button>\r\n          <button data-action=\"close\" title=\"Close toolbox\">\r\n            <i class=\"fa fa-times\">âœ–</i>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    refs.url.value = currentTarget.firstElementChild.src;\r\n    refs.alt.value = currentTarget.firstElementChild.alt;\r\n    if (currentTarget.dataset.link) {\r\n      refs.link.value = currentTarget.dataset.link;\r\n    }\r\n\r\n\r\n    // ---- Methods ------------\r\n\r\n    function updateTarget() {\r\n      selectNodeExt(currentTarget);\r\n      const link = refs.link.value ? `data-link=\"${refs.link.value}\" ` : \"\";\r\n      document.execCommand(\"insertHTML\", false, `<figure data-md=\"img\" data-block=\"true\" data-noedit=\"true\" ${link}data-click=\"showImageOptions\"><img src=\"${refs.url.value}\" alt=\"${refs.alt.value}\"/></figure>`);\r\n    }\r\n\r\n    function copyLink() {\r\n      refs.url.select();\r\n      document.execCommand(\"copy\");\r\n      refs.url.blur();\r\n    }\r\n\r\n\r\n    // ---- API ----------------\r\n\r\n    return {\r\n      element,\r\n      command: cmd => {\r\n        switch (cmd) {\r\n          case \"update\":\r\n            updateTarget();\r\n            return;\r\n\r\n          case \"copy\":\r\n            copyLink();\r\n            return true;\r\n\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n    };\r\n  }\r\n}\r\n","import { template } from \"@ludekarts/utility-belt\";\r\n\r\nexport default function EmbedEditor() {\r\n  return currentTarget => {\r\n    const element = template`\r\n      <div class=\"toolbox-controllers\">\r\n        <button data-action=\"follow\" title=\"Open in YouTube\">\r\n          <i class=\"fa fa-eraser\">â†—</i>\r\n        </button>\r\n        <button data-action=\"close\" title=\"Close toolbox\">\r\n          <i class=\"fa fa-times\">âœ–</i>\r\n        </button>\r\n      </div>\r\n    `;\r\n\r\n\r\n    // ---- Methods ------------\r\n\r\n    function followLink() {\r\n      window.open(currentTarget.firstElementChild.alt, \"_blank\");\r\n    }\r\n\r\n\r\n    // ---- API ----------------\r\n\r\n    return {\r\n      element,\r\n      command: cmd => {\r\n        switch (cmd) {\r\n          case \"follow\":\r\n            followLink();\r\n            break;\r\n\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n    };\r\n  };\r\n}"],"names":["i","Date","Math","random","toString","A","e","n","t","r","length","U","arguments","Array","isArray","raw","Error","reduce","o","u","a","slice","call","NodeList","HTMLElement","c","document","createElement","insertAdjacentHTML","querySelectorAll","getAttribute","removeAttribute","forEach","id","parentNode","insertBefore","remove","replaceChild","children","selectInlineRange","element","satrt","end","range","createRange","selection","window","getSelection","setStart","setEnd","removeAllRanges","addRange","selectNode","node","getRangeAt","selectNodeExt","nodeType","endLength","nextSibling","textContent","previousSibling","selectionToHtml","wrapper","container","isCollapsed","appendChild","cloneContents","unwrapNode","zeroWidthSpaceStart","createTextNode","zeroWidthSpaceEnd","insertNodeBefore","insertNodeAfter","content","innerHTML","replace","execCommand","replaceNode","contnent","newNode","headlines","#","##","###","####","#####","######","markdownToHtml","match","format","head","tail","trim","alt","imgUrl","url","text","indexOf","test","includes","URLSearchParams","get","formatYTCover","cropUrl","markdownMarkup","bold","italic","strike","upper","quote","line","_","embed","link","name","img","imglink","insertNode","target","markup","extractMarkdown","from","childNodes","acc","nodeName","dataset","md","firstElementChild","src","href","transform","parseMarkdown","markdown","pattern","getCaretNode","anchorNode","getCaretPosition","clonedRange","cloneRange","selectNodeContents","endContainer","endOffset","position","detach","caretAfterNode","setStartAfter","setEndAfter","collapse","caretBeforeNode","setStartBefore","setEndBefore","resetCurrentCaretStyle","caretAtIndex","chromeEolHack","insertCallback","eol","block","selector","namespace","style","createStyles","undoMode","selectedBlock","selectionMenuLock","querySelector","miniedit","setAttribute","focus","callback","timeout","observeNode","toolbox","currentTool","currentTarget","basic","editors","toolsFactory","template","refs","command","cmd","classList","toggle","size","strong","value","open","select","blur","getEditor","type","map","substring","split","join","className","showToolbox","tool","editor","getBoundingClientRect","x","width","top","y","offsetHeight","left","offsetWidth","add","addEventListener","watchForClose","event","contains","removeEventListener","closeToolbox","action","Object","freeze","close","selectedHtml","Toolbox","render","exec","index","lastIndex","later","apply","clearTimeout","setTimeout","ctrlKey","metaKey","preventDefault","noedit","stopPropagation","code","deleteNode","outerHTML","nextElementSibling","caretToStart","console","log","clipboardData","setData","getData","MutationObserver","mutationsList","observerRef","mutation","addedNodes","addedNode","observe","subtree","childList","characterData","setText","insertText","getText"],"mappings":"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"}